<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Asset Strengthener</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
:root{
  --bg-gradient: linear-gradient(135deg,#6a11cb,#2575fc);
  --card-bg: #fff;
  --accent: #ff9a00;
  --muted: #666;
  --glass: rgba(255,255,255,0.06);
}
html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg-gradient);}
.container{max-width:980px;margin:28px auto;padding:18px;}
/* navbar pill style */
.nav{
  display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,0.95);
  padding:10px 14px;border-radius:999px;box-shadow:0 8px 30px rgba(0,0,0,0.12);
}
.nav-left{display:flex;gap:12px;align-items:center}
.brand{display:flex;gap:12px;align-items:center}
.logo-badge{width:44px;height:44px;border-radius:50%;background:#6a11cb;border:4px solid #ff9a00;display:flex;align-items:center;justify-content:center}
.logo-badge svg{width:26px;height:26px}
.nav-links{display:flex;gap:16px;align-items:center}
.nav-links a{padding:8px 14px;border-radius:999px;text-decoration:none;color:#000;font-weight:600}
.nav-links a.active{background:linear-gradient(90deg,#ffecd2,#ffd6a5);color:#000;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.nav-right{display:flex;gap:10px;align-items:center}
.btn-logout{background:#ff9a00;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;color:#000}

/* page card */
.card{
  background:var(--card-bg);border-radius:12px;padding:22px;margin-top:20px;box-shadow:0 20px 60px rgba(0,0,0,0.12);
  color:#000;
}
header{display:flex;flex-direction:column;gap:6px}
h1{margin:0}
.lead{color:var(--muted);margin:0 0 6px 0;font-size:14px}

/* form */
form.grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
label{display:block;margin-bottom:8px;font-weight:600}
textarea{width:100%;min-height:160px;padding:12px;border-radius:10px;border:1px solid #eee;font-size:14px;resize:vertical}
.controls{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.small{font-size:13px;color:var(--muted)}
.note{font-size:13px;color:var(--muted);margin-top:10px}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:10px;flex-wrap:wrap}

/* output monospace */
.output{font-family:monospace;min-height:160px}

/* responsive */
@media(max-width:900px){form.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="container">

  <!-- NAVBAR -->
  <div class="nav">
    <div class="nav-left">
      <div class="brand">
        <div class="logo-badge" title="Asset Strengthener">
          <!-- inline SVG lightning -->
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#6a11cb" stroke="#ff9a00" stroke-width="6"/>
            <path d="M55 15L30 55H50L45 85L70 45H50L55 15Z" fill="#ff9a00"/>
          </svg>
        </div>
        <div>
          <div style="font-weight:700;color:#000">Asset Strengthener</div>
          <div style="font-size:12px;color:#444">Encode & wrap assets</div>
        </div>
      </div>

      <div class="nav-links" style="margin-left:18px">
        <a href="dashboard.html">Dashboard</a>
        <a class="active" href="asset-strengthener.html">Asset Strengthener</a>
        <a href="random-word-generator.html">Random Word Generator</a>
      </div>
    </div>

    <div class="nav-right">
      <div style="font-weight:600;color:#000">Hi, <span id="userTag">User</span></div>
      <button class="btn-logout" id="logout">Logout</button>
    </div>
  </div>

  <!-- MAIN -->
  <div class="card">
    <header>
      <h1>Asset Strengthener</h1>
      <p class="lead">Paste your asset, click <strong>Run</strong>. Output will be wrapped in <code>=?UTF-8?Q? ... ?=</code>.</p>
    </header>

    <form id="form" class="grid" onsubmit="return false;">
      <div>
        <label for="input">Input asset</label>
        <textarea id="input">Congrats! Claim Your FREE Car Emergency Kit Now!</textarea>

        <div style="margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <div class="small">Insert <code>=CD=8F</code> probability:</div>
          <input id="prob" type="range" min="0" max="100" value="40" />
          <div class="small" id="probVal">40%</div>
        </div>
      </div>

      <div>
        <label for="output">Output (quoted-printable)</label>
        <textarea id="output" class="output" readonly></textarea>

        <div class="footer">
          <div class="controls">
            <button id="run" style="background:#ff9a00;border-radius:10px;padding:10px 14px;color:#000;border:none;font-weight:700;cursor:pointer">Run</button>
            <button id="copy" style="background:#ffa64d;border-radius:10px;padding:10px 14px;color:#000;border:none;cursor:pointer;font-weight:700">Copy</button>
            <button id="reset" style="background:#cc3300;border-radius:10px;padding:10px 14px;color:#fff;border:none;cursor:pointer;font-weight:700">Reset</button>
          </div>

          <div class="note">Uses hex Unicode from JS <code>charCodeAt</code>. Does not insert <code>=CD=8F</code> inside <code>=XX</code> sequences.</div>
        </div>
      </div>
    </form>
  </div>

</div>

<script>
// guard: require login
if(sessionStorage.getItem('logged') !== 'yes') location.href = 'index.html';
document.getElementById('userTag').textContent = sessionStorage.getItem('username') || 'User';

// logout
document.getElementById('logout').addEventListener('click', () => {
  sessionStorage.clear();
  location.href = 'index.html';
});

// ASSET STRENGTHENER SCRIPT (fixed return)
function replaceRandomWithUnicode(word) {
  if (!word || word.length === 0) return word;
  const letterIndexes = [];
  for (let i = 0; i < word.length; i++) {
    if (/\w/.test(word[i])) letterIndexes.push(i);
  }
  if (letterIndexes.length === 0) return word;
  const idx = letterIndexes[Math.floor(Math.random() * letterIndexes.length)];
  const ch = word[idx];
  const hex = ch.charCodeAt(0).toString(16).toUpperCase();
  const padded = hex.length % 2 === 1 ? ('0' + hex) : hex;
  return word.slice(0, idx) + '=' + padded + word.slice(idx + 1);
}

function insertCD8F(word, probPercent) {
  let out = '';
  let i = 0;
  while (i < word.length) {
    const ch = word[i];
    if (ch === '=') {
      let j = i + 1;
      while (j < word.length && /[0-9A-Fa-f]/.test(word[j])) j++;
      out += word.slice(i, j);
      i = j;
      continue;
    }
    out += ch;
    if (i < word.length - 1 && Math.random() * 100 < probPercent && word[i+1] !== '=') {
      out += '=CD=8F';
    }
    i++;
  }
  return out;
}

function strengthenAsset(asset, probPercent) {
  const words = asset.split(/\s+/);
  const strengthened = words.map(w => {
    let newW = replaceRandomWithUnicode(w);
    newW = insertCD8F(newW, probPercent);
    return newW;
  });
  const joined = strengthened.join('________________=20=20=20=20____________');
  // return quoted-printable wrapper string correctly
  return '=?UTF-8?Q?' + joined + '?=';
}

const inputEl = document.getElementById('input');
const outputEl = document.getElementById('output');
const runBtn = document.getElementById('run');
const copyBtn = document.getElementById('copy');
const resetBtn = document.getElementById('reset');
const probEl = document.getElementById('prob');
const probVal = document.getElementById('probVal');

probEl.addEventListener('input', () => probVal.textContent = probEl.value + '%');

runBtn.addEventListener('click', () => {
  const asset = inputEl.value.trim();
  const prob = Number(probEl.value);
  if (!asset) {
    outputEl.value = '';
    return;
  }
  try {
    const out = strengthenAsset(asset, prob);
    outputEl.value = out;
  } catch (e) {
    outputEl.value = 'Error: ' + e.message;
  }
});

copyBtn.addEventListener('click', async () => {
  const text = outputEl.value || '';
  if (!text) return;
  try {
    await navigator.clipboard.writeText(text);
    const prev = copyBtn.textContent;
    copyBtn.textContent = 'Copied âœ“';
    setTimeout(() => copyBtn.textContent = prev, 1200);
  } catch (e) {
    alert('Copy failed: ' + e.message);
  }
});

resetBtn.addEventListener('click', () => {
  inputEl.value = '';
  outputEl.value = '';
});

// optional: run once with default
// runBtn.click();

</script>
</body>
</html>
